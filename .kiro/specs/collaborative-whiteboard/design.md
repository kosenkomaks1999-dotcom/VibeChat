# Design Document: Collaborative Whiteboard

## Overview

Collaborative Whiteboard - —ç—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å HTML5 Canvas, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∫–æ–º–Ω–∞—Ç—ã —Ä–∏—Å–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –í—Å–µ —à—Ç—Ä–∏—Ö–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Firebase Realtime Database —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π —Ç—Ä–∞—Ñ–∏–∫–∞.

## Architecture

### High-Level Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     VibeChat Application                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Room UI    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   WhiteboardManager          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ         ‚îÇ   - Canvas rendering         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [Open Board] ‚îÇ         ‚îÇ   - Tool management          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ   - Stroke drawing           ‚îÇ  ‚îÇ
‚îÇ                           ‚îÇ   - Firebase sync            ‚îÇ  ‚îÇ
‚îÇ                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                      ‚îÇ                       ‚îÇ
‚îÇ                                      ‚ñº                       ‚îÇ
‚îÇ                           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ                           ‚îÇ   Firebase Realtime DB       ‚îÇ  ‚îÇ
‚îÇ                           ‚îÇ   rooms/{roomId}/whiteboard/ ‚îÇ  ‚îÇ
‚îÇ                           ‚îÇ     - strokes/               ‚îÇ  ‚îÇ
‚îÇ                           ‚îÇ     - cursors/               ‚îÇ  ‚îÇ
‚îÇ                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Component Diagram

```
WhiteboardManager
‚îú‚îÄ‚îÄ Canvas (HTML5)
‚îú‚îÄ‚îÄ Toolbar
‚îÇ   ‚îú‚îÄ‚îÄ Tool Selector (Pen, Marker, Eraser)
‚îÇ   ‚îú‚îÄ‚îÄ Color Picker
‚îÇ   ‚îú‚îÄ‚îÄ Size Slider
‚îÇ   ‚îî‚îÄ‚îÄ Action Buttons (Clear, Save)
‚îú‚îÄ‚îÄ Drawing Engine
‚îÇ   ‚îú‚îÄ‚îÄ Mouse/Touch Event Handler
‚îÇ   ‚îú‚îÄ‚îÄ Stroke Builder
‚îÇ   ‚îî‚îÄ‚îÄ Renderer
‚îî‚îÄ‚îÄ Firebase Sync
    ‚îú‚îÄ‚îÄ Stroke Publisher
    ‚îú‚îÄ‚îÄ Stroke Subscriber
    ‚îî‚îÄ‚îÄ Cursor Tracker
```

## Components and Interfaces

### 1. WhiteboardManager Class

**Responsibilities:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –¥–æ—Å–∫–∏
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

**Interface:**
```javascript
class WhiteboardManager {
  constructor(roomRef, myUserId, myNickname)
  
  // Lifecycle
  open()                    // –û—Ç–∫—Ä—ã—Ç—å –¥–æ—Å–∫—É
  close()                   // –ó–∞–∫—Ä—ã—Ç—å –¥–æ—Å–∫—É
  
  // Tools
  setTool(tool)            // 'pen', 'marker', 'eraser'
  setColor(color)          // Hex color
  setSize(size)            // 1-50
  
  // Actions
  clear()                  // –û—á–∏—Å—Ç–∏—Ç—å –¥–æ—Å–∫—É (–¥–ª—è –≤—Å–µ—Ö)
  saveAsPNG()              // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –∫–∞—Ä—Ç–∏–Ω–∫—É
  
  // Firebase sync
  startListening()         // –ù–∞—á–∞—Ç—å —Å–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
  stopListening()          // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—å
}
```

### 2. DrawingEngine

**Responsibilities:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏/—Ç–∞—á–∞
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —à—Ç—Ä–∏—Ö–æ–≤ –∏–∑ —Ç–æ—á–µ–∫
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –Ω–∞ Canvas

**Interface:**
```javascript
class DrawingEngine {
  constructor(canvas, context)
  
  // Event handlers
  onMouseDown(e)
  onMouseMove(e)
  onMouseUp(e)
  
  // Drawing
  startStroke(x, y)
  addPoint(x, y)
  endStroke()
  
  // Rendering
  drawStroke(stroke)       // –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –æ–¥–∏–Ω —à—Ç—Ä–∏—Ö
  drawAllStrokes(strokes)  // –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –≤—Å–µ —à—Ç—Ä–∏—Ö–∏
  clearCanvas()            // –û—á–∏—Å—Ç–∏—Ç—å canvas
}
```

### 3. FirebaseSync

**Responsibilities:**
- –û—Ç–ø—Ä–∞–≤–∫–∞ —à—Ç—Ä–∏—Ö–æ–≤ –≤ Firebase
- –ü–æ–ª—É—á–µ–Ω–∏–µ —à—Ç—Ä–∏—Ö–æ–≤ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ (–±–∞—Ç—á–∏–Ω–≥)

**Interface:**
```javascript
class FirebaseSync {
  constructor(roomRef, myUserId)
  
  // Publishing
  publishStroke(stroke)    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —à—Ç—Ä–∏—Ö
  publishCursor(x, y)      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
  
  // Subscribing
  onStrokeAdded(callback)  // Callback –ø—Ä–∏ –Ω–æ–≤–æ–º —à—Ç—Ä–∏—Ö–µ
  onStrokeRemoved(callback)// Callback –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
  onCursorMoved(callback)  // Callback –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
  
  // Management
  clearAllStrokes()        // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —à—Ç—Ä–∏—Ö–∏
  loadExistingStrokes()    // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
}
```

## Data Models

### Stroke Data Structure

```javascript
{
  id: "stroke_1234567890",
  userId: "user123",
  nickname: "John",
  tool: "pen",              // 'pen', 'marker', 'eraser'
  color: "#000000",
  size: 2,
  points: [
    {x: 100, y: 150},
    {x: 101, y: 151},
    // ... –¥–æ 50 —Ç–æ—á–µ–∫
  ],
  timestamp: 1234567890
}
```

### Cursor Data Structure

```javascript
{
  userId: "user123",
  nickname: "John",
  x: 400,
  y: 300,
  timestamp: 1234567890
}
```

### Firebase Structure

```
rooms/
  {roomId}/
    whiteboard/
      strokes/
        {strokeId}/
          userId: "user123"
          nickname: "John"
          tool: "pen"
          color: "#000000"
          size: 2
          points: [{x, y}, ...]
          timestamp: 1234567890
      cursors/
        {userId}/
          nickname: "John"
          x: 400
          y: 300
          timestamp: 1234567890
```

## UI Design

### Modal Layout

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Whiteboard                                    [X]       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ              Canvas (800x600)                    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [üñäÔ∏è Pen] [üñçÔ∏è Marker] [üßπ Eraser]                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îê                            ‚îÇ
‚îÇ  ‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ‚ñà‚îÇ  Colors                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îò                            ‚îÇ
‚îÇ  Size: ‚îÅ‚îÅ‚îÅ‚îÅ‚óè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ (5)                                  ‚îÇ
‚îÇ  [üóëÔ∏è Clear] [üíæ Save PNG]                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Color Palette

12 –±–∞–∑–æ–≤—ã—Ö —Ü–≤–µ—Ç–æ–≤:
- Black (#000000)
- White (#FFFFFF)
- Red (#FF0000)
- Green (#00FF00)
- Blue (#0000FF)
- Yellow (#FFFF00)
- Orange (#FF8800)
- Purple (#8800FF)
- Pink (#FF00FF)
- Cyan (#00FFFF)
- Brown (#8B4513)
- Gray (#808080)

## Performance Optimization

### 1. Stroke Batching

–í–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ, –≥—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç–æ—á–∫–∏:
- –°–æ–±–∏—Ä–∞–µ–º —Ç–æ—á–∫–∏ –≤ –±—É—Ñ–µ—Ä
- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞–∫–µ—Ç –∫–∞–∂–¥—ã–µ 50-100–º—Å
- –ú–∞–∫—Å–∏–º—É–º 10 —Ç–æ—á–µ–∫ –≤ –ø–∞–∫–µ—Ç–µ

### 2. Canvas Optimization

- –ò—Å–ø–æ–ª—å–∑—É–µ–º `requestAnimationFrame` –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
- –ö—ç—à–∏—Ä—É–µ–º —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —à—Ç—Ä–∏—Ö–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `willReadFrequently: true` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è

### 3. Firebase Optimization

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –º–∞–∫—Å–∏–º—É–º 1000 —à—Ç—Ä–∏—Ö–æ–≤
- –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —à—Ç—Ä–∏—Ö–æ–≤ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —à—Ç—Ä–∏—Ö–æ–≤ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ timestamp –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö

### 4. Memory Management

- –û—á–∏—Å—Ç–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–æ—Å–∫–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–æ–≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (>5 —Å–µ–∫—É–Ω–¥)
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## Error Handling

### Network Errors

- –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "Reconnecting..."
- –ë—É—Ñ–µ—Ä–∏–∑—É–µ–º —à—Ç—Ä–∏—Ö–∏ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
- –ú–∞–∫—Å–∏–º—É–º 50 —à—Ç—Ä–∏—Ö–æ–≤ –≤ –±—É—Ñ–µ—Ä–µ

### Permission Errors

- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Firebase –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –¥–æ—Å–∫–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤

### Canvas Errors

- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Canvas –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- Fallback —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ Canvas –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

## Testing Strategy

### Unit Tests

- `WhiteboardManager`: lifecycle, tool switching
- `DrawingEngine`: stroke building, rendering
- `FirebaseSync`: publishing, subscribing, batching

### Integration Tests

- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –û—á–∏—Å—Ç–∫–∞ –¥–æ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PNG

### Manual Testing

- –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ 3+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å 500+ —à—Ç—Ä–∏—Ö–∞–º–∏
- –†–∞–±–æ—Ç–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö —ç–∫—Ä–∞–Ω–∞

## Security Considerations

### Firebase Rules

```json
{
  "rules": {
    "rooms": {
      "$roomId": {
        "whiteboard": {
          ".read": "auth != null",
          ".write": "auth != null",
          "strokes": {
            "$strokeId": {
              ".validate": "newData.hasChildren(['userId', 'tool', 'color', 'size', 'points', 'timestamp'])"
            }
          }
        }
      }
    }
  }
}
```

### Input Validation

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (0-800 –¥–ª—è x, 0-600 –¥–ª—è y)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–≤–µ—Ç–∞ (hex —Ñ–æ—Ä–º–∞—Ç)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (1-50)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ—á–µ–∫ –≤ —à—Ç—Ä–∏—Ö–µ (–º–∞–∫—Å 100)

## Future Enhancements

- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "–§–∏–≥—É—Ä—ã" (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫, –∫—Ä—É–≥, –ª–∏–Ω–∏—è)
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "–¢–µ–∫—Å—Ç"
- –û—Ç–º–µ–Ω–∞/–ü–æ–≤—Ç–æ—Ä (Undo/Redo)
- –°–ª–æ–∏
- –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
